<html>
<title>

    <style>
        .fire1div {
            width: 2%;
            height: 5%;
            position: absolute;
            z-index: 10;
            background-image: url('rocket.gif');
            background-size: 100% 100%;
        }

        .enemy1 {
            width: 15%;
            height: 15%;
            position: absolute;
            top: 100px;
            z-index: 10;
            right: -200px;
            background-image: url('enemy1.png');
            background-size: 100% 100%;
        }
    </style>

</title>

<body style="margin: 0%;padding: 0%;overflow: hidden;">

    <div id="bg1" style="width:100%;height:101%;position: absolute; background-image: url('bg1.jpg');">
    </div>
    <div id="bg2" style="width:100%;height:101%;position: absolute; background-image: url('bg1.jpg');">
    </div>
    <div id="playerShip" style="width:15%;height:15%;position: absolute;z-index:10 ; background-image: url('spaceship.png');
    background-size: 100% 100%;">
        <div id="exaust1"
            style="width:15%;height:15%;position: absolute;right:53%;top:100%;z-index:10 ; background-image: url('engine.gif');background-size: 100% 100%;transform: scaleY(-1);">
        </div>
        <div id="exaust2"
            style="width:15%;height:15%;position: absolute;right:31%;top:100%;z-index:10 ; background-image: url('engine.gif');background-size: 100% 100%;transform: scaleY(-1);">
        </div>
        <div id="exaust3"
            style="width:15%;height:15%;position: absolute;right:15%;top:85%;z-index:10 ; background-image: url('engine.gif');background-size: 100% 100%;transform: scaleY(-1);">
        </div>
        <div id="exaust4"
            style="width:15%;height:15%;position: absolute;right:69%;top:85%;z-index:10 ; background-image: url('engine.gif');background-size: 100% 100%;transform: scaleY(-1);">
        </div>
    </div>
    <div id="enemyContainer1"></div>

    <!-- <div style="width:100%;height:100%;position: absolute; background-image: url('bg1.jpg');">
    </div> -->
    <!-- <canvas id="mainCanvas" style="border:1px solid #000000;">
    </canvas> -->


    <script>
        var playerShip = document.getElementById("playerShip");
        let playertop = window.innerHeight * .7;
        let playerright = window.innerWidth * .45;
        let bgImageV1 = 0;
        let bgImageV2 = -window.innerHeight;
        let bgImageVFrameShift = 1;

        // init();

        function init() {
            canvas = document.getElementById("mainCanvas");
            canvas.width = document.body.clientWidth; //document.width is obsolete
            canvas.height = document.body.clientHeight; //document.height is obsolete
            canvasW = canvas.width;
            canvasH = canvas.height;
        }

        let speedMax = 10;
        let speedUp = 1;
        let speedDown = 1;
        let speedRight = 1;
        let speedLeft = 1;
        let keysPressed = {};
        document.addEventListener('keydown', (event) => {
            keysPressed[event.key] = true;
            // console.log(event.key)
        });

        document.addEventListener('keyup', (event) => {
            // console.log(event.key)
            if (event.key == "ArrowRight")
                speedRight = 1;
            if (event.key == "ArrowUp")
                speedUp = 1;
            if (event.key == "ArrowLeft")
                speedLeft = 1;
            if (event.key == "ArrowDown")
                speedDown = 1;

            delete keysPressed[event.key];
        });


        let fire1perioud = 10;
        let lastFire = 10;
        let lastFirePosition = -1;

        function fire1() {
            var fire1div = document.createElement("DIV");
            fire1div.classList.add("fire1div");
            document.body.appendChild(fire1div);
            fire1div.style.position = "absolute";
            fire1div.style.top = playertop;
            lastFirePosition = -lastFirePosition;
            fire1div.style.width = "2%"
            fire1div.style.height = "5%"
            fire1div.style.right = parseInt(playerright) + parseInt(playerShip.clientWidth) / 2 - parseInt(fire1div.clientWidth) / 2 + lastFirePosition * 10;
            fire1div.style.backgroundImage = "url('fire1.png')";
            fire1div.style.backgroundSize = "100% 100%"
            lastFire = fire1perioud;
        }

        let right = true;
        let up = true;
        let left = true;
        let down = true;



        function moveBg() {
            bgImageV1 += bgImageVFrameShift;
            bgImageV2 += bgImageVFrameShift;
            if (bgImageV1 > window.innerHeight) bgImageV1 = -window.innerHeight
            document.getElementById("bg1").style.top = bgImageV1 + "px";
            if (bgImageV2 > window.innerHeight) bgImageV2 = -window.innerHeight
            document.getElementById("bg2").style.top = bgImageV2 + "px";

            right = true;
            up = true;
            left = true;
            down = true;

            if (keysPressed['Control'] && keysPressed['a']) { }
            if (keysPressed[' ']) {
                if (lastFire < 1)
                    fire1();
            }

            if (keysPressed['ArrowRight'] && keysPressed['ArrowUp']) {
                playerright -= speedRight;
                if (speedRight < speedMax) speedRight++;
                playertop -= speedUp;
                if (speedUp < speedMax) speedUp++;
                right = false;
                up = false;
            }
            if (keysPressed['ArrowRight'] && keysPressed['ArrowDown']) {
                playerright -= speedRight;
                if (speedRight < speedMax) speedRight++;
                playertop += speedDown;
                if (speedDown < speedMax) speedDown++;
                right = false;
                down = false;
            }
            if (keysPressed['ArrowLeft'] && keysPressed['ArrowUp']) {
                playerright += speedLeft;
                if (speedLeft < speedMax) speedLeft++;
                playertop -= speedUp;
                if (speedUp < speedMax) speedUp++;
                left = false;
                up = false;
            }
            if (keysPressed['ArrowLeft'] && keysPressed['ArrowDown']) {
                playerright += speedLeft;
                if (speedLeft < speedMax) speedLeft++;
                playertop += speedDown;
                if (speedDown < speedMax) speedDown++;
                left = false;
                down = false;
            }


            // if (event.key == 32) // space
            // {

            // }
            if (keysPressed["ArrowRight"] && right) // right
            {
                playerright -= speedRight;
                if (speedRight < speedMax) speedRight++;
            }
            if (keysPressed["ArrowUp"] && up) // up 
            {
                playertop -= speedUp;
                if (speedUp < speedMax) speedUp++;
            }
            if (keysPressed["ArrowLeft"] && left) // left
            {
                playerright += speedLeft;
                if (speedLeft < speedMax) speedLeft++;
            }
            if (keysPressed["ArrowDown"] && down) // down
            {
                playertop += speedDown;
                if (speedDown < speedMax) speedDown++;
            }
            update()

        }

        var int = self.setInterval(moveBg, 10);

        let enemy1_top_lineX = 100;
        let enemy1_lineY_fluxwation = 50;
        function update() {
            var x = document.getElementsByClassName("enemy1")
            for (i = 0; i < x.length; i++) {
                x[i].style.right = parseInt(x[i].style.right) + 5;
                x[i].style.top = enemy1_lineY_fluxwation * Math.sin(parseInt(x[i].style.right) / 40) + enemy1_top_lineX;
                if (parseInt(x[i].style.right) > window.innerWidth + 400)
                    x[i].parentNode.removeChild(x[i]);
            }


            if (playertop > window.innerHeight * .8)
                playertop = window.innerHeight * .8;
            if (playertop < window.innerHeight * .0)
                playertop = window.innerHeight * .0;
            if (playerright > window.innerWidth * .8)
                playerright = window.innerWidth * .8;
            if (playerright < window.innerWidth * .05)
                playerright = window.innerWidth * .05;
            playerShip.style.top = playertop;
            playerShip.style.right = playerright;


            var x = document.getElementsByClassName("fire1div")
            for (i = 0; i < x.length; i++) {
                if (parseInt(x[i].style.top) > 0)
                    x[i].style.top = parseInt(x[i].style.top) - 10;
                else {
                    x[i].parentNode.removeChild(x[i]);
                }
            }
            lastFire--;

        }


        function createEnemy1() {
            var enemy1 = document.createElement("DIV");
            enemy1.classList.add("enemy1");

            document.getElementById("enemyContainer1").appendChild(enemy1);
            enemy1.style.position = "absolute";
            enemy1.style.top = 100;
            enemy1.style.right = -400;
            enemy1.style.width = "15%"
            enemy1.style.height = "15%"
            enemy1.style.backgroundImage = "url('enemy1.png')";
            enemy1.style.backgroundSize = "100% 100%"
        }

        function generateEnemies(enemy_count, time_diff, line_x, y_fluxwation) { // generateEnemy(number of enemies , timedifference , enemy1_top_lineX , enemy1_lineY_fluxwation)
            for (i = 0; i < enemy_count; i++) {
                setTimeout(function () { createEnemy1(); }, i * time_diff);
            }


        }

        setTimeout(function () { generateEnemies(5, 2000, 100, 50); }, 100);


        update();
    </script>
</body>

</html>